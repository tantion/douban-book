define("js/search",function(require,a,b){"use strict";function c(){var a={},b=m("#content"),c=m("#info"),d=m.trim(c.text()),e=d.split(/([^ \n]+):/),f=e.length,g={};return m.each(e,function(a,b){var c,d;a%2===1&&f-1>a&&(c=m.trim(b),d=m.trim(e[a+1].replace(/\n/g,"").replace(/ {2,}/g," ")),g[c]=d)}),a.title=m.trim(m("#wrapper").find('[property="v:itemreviewed"]').text()),a.stars=parseFloat(b.find('[property="v:average"]').text()),a.author=g.hasOwnProperty("作者")?g["作者"]:"",a.year=parseInt(g.hasOwnProperty("出版年")?g["出版年"]:0,10),a.isbn=parseInt(g.hasOwnProperty("ISBN")?g.ISBN:0,10),a}function d(){var a={};return a.title=m.trim(m(".article-title").text()),a}function e(a,b,c){var d=b.data("index"),e=c.find(b.attr("href")),f=b.find("span"),g=q[d];g.search(a).progress(function(a){e.html(a),f.html("..")}).done(function(a,b){e.html(a),f.html(b||0)}).fail(function(){e.html("没有搜到相关的电子书，切换一下其他搜索试试。"),f.html(0)})}function f(a,b){{var c=a.data("index"),d=b.find(a.attr("href"));q[c]}a.siblings().removeClass("active"),a.addClass("active"),d.siblings().removeClass("active"),d.addClass("active")}function g(a){var b='<div class="book-improve-bt-container"><div class="book-improve-nav-container">{{#tabs}}{{#index}}&nbsp;|&nbsp;{{/index}}<a class="book-improve-nav" data-index="{{index}}" href="#book-improve-tab-{{index}}">{{name}} (<span>...</span>)</a>{{/tabs}}</div><div class="book-improve-tab-container">{{#tabs}}<div class="book-improve-tab" id="book-improve-tab-{{index}}"></div>{{/tabs}}</div></div>',c=null,d=null;return c=m.map(q,function(a,b){return{name:a.name||"未名",index:b}}),d=m(o.render(b,{tabs:c})),d.on("click",".book-improve-nav",function(b){b.preventDefault();var c=m(this);f(c,d),e(a,c,d)}).find(".book-improve-nav").each(function(b){var c=m(this);0===b&&f(c,d),e(a,c,d)}),n.setTitle(a.title+" 电子书列表"),d}function h(a){n||(n=dui.Dialog({nodeId:"book-improve-dialog",width:700},!0)),n.setContent(g(a)),n.open()}function i(a,b){var c=a.text()||"";c=c.replace(/\(.+\)/,"("+b+")"),a.text(c)}function j(a,b){var c=0;p.each(q,function(d,e){d.search(b).done(function(b,d){c+=d,i(a,c)}).always(function(){e()})},function(){i(a,c)})}function k(){var a=m('<div><span class="pl">电子书:</span> <a href="javascript:">打开列表 (..)</a></div>').appendTo("#info").find("a"),b=c();a.on("click",function(a){a.preventDefault(),h(b)}),j(a,b)}function l(){var a=m('<p><span class="label">电子书</span><a href="javascript:">打开列表 (..)</a></p>').appendTo(".article-meta").find("a").css({fontSize:"12px"}),b=d();a.on("click",function(a){a.preventDefault(),h(b)}),j(a,b)}var m=require("jquery"),n=null,o=require("mustache"),p=require("async"),q=[require("js/duokan"),require("js/ishare"),require("js/ppurl"),require("js/baidu")];b.exports={init:function(){var a=location.href;a.match(/^https?:\/\/book\.douban\.com\/subject\/\d+/)?k():a.match(/^https?:\/\/read\.douban\.com\/ebook\/\d+/)&&l()}}});